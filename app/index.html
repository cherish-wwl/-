<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" /> -->
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <title>公司介绍</title>
  <style>
    * {
      padding: 0;
      margin: 0;
      touch-action: pan-y;
    }

    html {
      font-size: 16px;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
    }

    .tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
      align-items: center;
      /* justify-content: space-between; */
      padding: 0 18px;
      overflow-x: auto;
    }

    .tabs .tab {
      /* flex: 0.25; */
      list-style: none;
      padding: 10px 0;
      text-align: center;
      font-size: 18px;
      color: #aaa;
      cursor: pointer;
      white-space: nowrap;
      margin-right: 20px;
    }

    .tabs .tab:last-child {
      text-align: right;
    }

    .tabs .tab:first-child {
      text-align: left;
    }

    .tabs .tab.active {
      color: #3172dc;
      font-weight: bold;
      position: relative;
    }

    .tabs .tab.active::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      height: 4px;
      background-color: #3172dc;
      width: 30%;
      border-radius: 4px;
    }

    .tabs-content {
      padding: 30px 18px;
    }

    .tabs-content .title {
      font-size: 20px;
      font-family: Source Han Sans CN;
      font-weight: bold;
      color: #333333;
      line-height: 30px;
    }

    .tabs-content .time {
      margin: 20px 0 25px;
      font-size: 12px;
      font-family: Source Han Sans CN;
      font-weight: 300;
      color: #a5b0be;
      line-height: 24px;
    }

    .tabs-content .context {
      font-size: 17px;
      font-family: Source Han Sans CN;
      font-weight: 400;
      color: #333333;
      line-height: 30px;
      word-break: break-word;
    }

    img, table{
      max-width: 100%;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header" id="header">
      <ul class="tabs" id="tabs">
      </ul>
    </div>
    <div class="tabs-content">
      <div class="tab-content" id="content">
      </div>
    </div>
  </div>
  <script>

    var env =  'test';
    // 'test'
    var tabid = 1;
    var data = {}
    var detail_id = getQueryVariable('d_id')
    var type = getQueryVariable('type')
    var c_id = getQueryVariable('c_id')
   
    init()
    function headerTabTemp(list){
      var str = ''
      for (var index = 0; index < list.length; index++) {
        var element = list[index];
        if(index == 0){
          tabid = element.id
        }
        str = str + '<li class="tab '+(index == 0 ? 'active' : '')+'" data-tabid="'+element.id+'">'+element.category_name+'</li>'
      }
      return str 
    }
    function init() {
      document.getElementById("header").innerHTML = ''
      if (detail_id) {
        getDetailInfo()
      } else if (type === 'about') {
        getAbout()
      } else if(c_id){
        getProtocalInfo()
      }else{
        getCategory()
      }
    }
    function getCategory(){
      http({url:'/api/v1/office/category',method:'get',success: function(res){
      var html = headerTabTemp(res.data.list)
      document.getElementById('tabs').innerHTML = html
      getData(tabid)
    }})
    }
    function getData(id) {
      http({url:'/api/v1/office/contentList?category_id='+id,method:'get',success: function(res){
        var data = res.data.list[0]
        showInfo(data);
      }})
        
    }

    function getDetailInfo() {
      http({url:'/api/v1/information/detail?information_id='+ detail_id,method:'get',success: function(res){
        var data = res.data.information
        showInfo(data);
      }})
    }
    function getProtocalInfo() {
      http({url:'/api/v1/protocol/content?c_id=' + c_id,method:'get',success: function(res){
        var data = res.data.protocol
        showInfo(data);
      }})
    }
    function getAbout() {
      var url = ''
      if(!url) return
      http({url:url,method:'get',success: function(res){
        var data = res.data.protocol
        showInfo(data);
      }})
    }
    function contextTemp(data) {
      return '<article>' +
                '<h1 class="title">'+(data.title || '')+'</h1>' +
                '<p class="time">'+(data.updated_at || '')+'</p>' +
                '<section class="context">'+(data.content || '')+'</section>' +
              '</article>';
    }

    function aboutContextTemp(data) {
      return '<article>' +
                '<section class="context">'+data.content+'</section>' +
              '</article>';
    }

    function showInfo(data) {
      document.getElementById("content").innerHTML = ''
      if(data){
        var html = contextTemp(data);
        document.getElementById("content").innerHTML = html;
      }
    }

    function getQueryVariable(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split("=");
        if (pair[0] === variable) { return pair[1]; }
      }
      return '';
    }

    document.getElementById("header").addEventListener("click", function (e) {
      if (e.target.classList.contains("tab")) {
        e.target.parentElement
          .querySelectorAll(".active")
          .forEach(function (dom) {
            dom.classList.remove("active");
          });
        e.target.classList.add("active");
        getData(e.target.dataset.tabid);
      }
    });

    

    function http(options) {
      var url = options.url;
      var method =options.method
      var  baseUrl = env == 'test' ? 'http://lili.today':'http://39.105.102.138'
      var XHR = new XMLHttpRequest();
      XHR.open(method, baseUrl + url, true)
      XHR.responseType = 'json'
      XHR.onreadystatechange = function () {
        if (XHR.readyState == 4 && XHR.status == 200) {
          if(options.success){
            options.success(XHR.response)
          }
        }
      }
      XHR.send(null)
    }
  </script>
</body>

</html>



